# BindCraft CLI

A command-line script to run the BindCraft protein design pipeline, originally designed for Google Colab.

## Requirements

1. Python 3.7+
2. BindCraft installed (see installation in the original notebook)
3. All BindCraft dependencies (ColabDesign, PyRosetta, etc.)

## Installation

### Option 1: Automatic Installation (Recommended)

Run the installation script that automatically installs all dependencies:

```bash
./install_bindcraft.sh
```

This script:
- Clones the BindCraft repository
- Installs ColabDesign
- Downloads AlphaFold2 parameters (~4GB)
- Installs PyRosetta
- Sets up all necessary permissions

**Note**: Installation may take several minutes, especially downloading the AlphaFold2 parameters.

### Option 2: Manual Installation

If you prefer to install manually:

1. Clone the BindCraft repository:
```bash
git clone https://github.com/martinpacesa/BindCraft.git bindcraft
```

2. Install dependencies:
```bash
pip install git+https://github.com/sokrypton/ColabDesign.git
pip install pyrosettacolabsetup
```

3. Download AlphaFold2 parameters:
```bash
mkdir -p bindcraft/params
cd bindcraft/params
aria2c -x 16 https://storage.googleapis.com/alphafold/alphafold_params_2022-12-06.tar
tar -xf alphafold_params_2022-12-06.tar
rm alphafold_params_2022-12-06.tar
touch done.txt
```

4. Set permissions:
```bash
chmod +x bindcraft/functions/dssp
chmod +x bindcraft/functions/DAlphaBall.gcc
```

## Usage

### 1. Create configuration file

Create a JSON file with design parameters. You can use `config.json` as a template:

```json
{
  "design_path": "./output/PDL1",
  "binder_name": "PDL1",
  "starting_pdb": "./example/PDL1.pdb",
  "chains": "A",
  "target_hotspot_residues": "",
  "lengths": [70, 150],
  "number_of_final_designs": 100,
  "load_previous_target_settings": "",
  "design_protocol": "Default",
  "prediction_protocol": "Default",
  "interface_protocol": "AlphaFold2",
  "template_protocol": "Default",
  "filter_option": "Default"
}
```

### 2. Run the pipeline

**Option A: Using the wrapper script (Recommended)**

```bash
./run_bindcraft.sh --config config.json
```

This script automatically activates the virtual environment and verifies that all dependencies are available.

**Option B: Manually activating the virtual environment**

```bash
source venv/bin/activate
python bindcraft_cli.py --config config.json
```

**Important note**: You must use the Python from the virtual environment (`venv/`) where all dependencies (PyRosetta, ColabDesign, etc.) are installed. If you run `python` directly without activating the venv, you will get import errors.

## Configuration Parameters

### Basic Parameters

- **design_path**: Path where generated designs will be saved
- **binder_name**: Name to use as prefix for designed binders
- **starting_pdb**: Path to the target protein PDB file
- **chains**: Chains to target (e.g., "A" or "A,C")
- **target_hotspot_residues**: Specific positions to target (optional, e.g., "1,2-10" or "A1-10,B1-20")
- **lengths**: Binder length range [min, max]
- **number_of_final_designs**: Number of final designs required
- **load_previous_target_settings**: Path to previous configuration to continue a design (optional)

### Advanced Parameters

- **design_protocol**: Design protocol
  - `"Default"`: Recommended default protocol
  - `"Beta-sheet"`: Promotes more beta sheet structures
  - `"Peptide"`: Optimized for helical peptide binders

- **prediction_protocol**: Prediction protocol
  - `"Default"`: Single sequence prediction of binder
  - `"HardTarget"`: Uses initial guess to improve prediction of difficult complexes

- **interface_protocol**: Interface design method
  - `"AlphaFold2"`: Interface generated by AlphaFold2 (default)
  - `"MPNN"`: Uses soluble MPNN to optimize the interface

- **template_protocol**: Target template protocol
  - `"Default"`: Allows limited flexibility
  - `"Masked"`: Allows greater flexibility of the target at side chain and backbone level

### Filters

- **filter_option**: Filter option for designs
  - `"Default"`: Recommended filters
  - `"Peptide"`: For peptide binder design
  - `"Relaxed"`: More permissive but may result in fewer experimental successes
  - `"Peptide_Relaxed"**: More permissive for non-helical peptides
  - `"None"`: No filters (for benchmarking)

## Output Structure

The pipeline generates the following directory structure:

```
design_path/
├── Trajectory/          # Generated trajectories
├── Trajectory/Relaxed/  # Relaxed trajectories
├── MPNN/                # MPNN designs
├── MPNN/Relaxed/        # Relaxed MPNN designs
├── Accepted/            # Accepted designs
├── Rejected/            # Rejected designs
├── trajectory_stats.csv # Trajectory statistics
├── mpnn_design_stats.csv # MPNN design statistics
└── final_design_stats.csv # Final statistics
```

## Notes

- **IMPORTANT**: Always use the `run_bindcraft.sh` script or activate the virtual environment before running. The system Python does not have the dependencies installed.
- The script requires BindCraft to be installed and configured correctly
- A JAX-compatible GPU is needed to run the pipeline
- The script can continue from where it left off if interrupted, as long as the CSV files exist
- To continue a previous design, use `load_previous_target_settings` pointing to the JSON file generated previously

## Differences from the Colab Notebook

- Does not require mounting Google Drive
- Does not use IPython widgets for real-time visualization
- Progress counters are shown in the console
- Configuration is read from a JSON file instead of widgets
